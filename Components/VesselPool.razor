
@using ins_tech_frontend_coding_task_blazor.Models

<div class="vessel-pool">
    <div class="vessel-pool__title">Vessel pool (@_groups.Count)</div>
 
    <div class="vessel-groups-wrapper">
        @foreach (var group in _groups)
        {
        <div class="vessel-group">
            <div class="vessel-group__title">
                @group.ShipDesignation (@group.Vessels.Count)
            </div>
            <div class="vessel-group__list">
                @foreach (var vessel in group.Vessels)
                {
                    <div class="vessel"
                        @key="vessel.Id"
                        style="@GetVesselStyle(vessel)"
                        title="@($"{group.ShipDesignation} ({vessel.Width}×{vessel.Height})")"
                    >
                        <div class="vessel__badge@(vessel.Width == 1 ? " vessel__badge--vertical" : "")">
                            @vessel.Width×@vessel.Height
                        </div>
                    </div>
                }
            </div>
        </div>
        }
    </div>
</div>

@code {
    [Parameter] public IReadOnlyList<FleetItem> Fleets { get; set; } = Array.Empty<FleetItem>();

    private readonly List<VesselGroup> _groups = new List<VesselGroup>();

    protected override void OnParametersSet()
    {
        _groups.Clear();

        if (Fleets is null || Fleets.Count == 0)
            return;

        for (var fleetIndex = 0; fleetIndex < Fleets.Count; fleetIndex++)
        {
            var fleet = Fleets[fleetIndex];
            var vessels = new List<Vessel>();
            for (var vesselIndex = 0; vesselIndex < fleet.ShipCount; vesselIndex++)
            {
                vessels.Add(new Vessel(
                    Id: $"{fleetIndex}_{vesselIndex}",
                    Width: fleet.SingleShipDimensions.Width,
                    Height: fleet.SingleShipDimensions.Height
                ));
            }
            _groups.Add(new VesselGroup(fleet.ShipDesignation, vessels));
        }
    }

    private static string GetVesselStyle(Vessel vessel) =>
        $"width: calc({vessel.Width} * var(--cell-size));"+
        $"height: calc({vessel.Height} * var(--cell-size));";

    private sealed record Vessel(string Id, int Width, int Height);
    
    private sealed record VesselGroup(string ShipDesignation, List<Vessel> Vessels);
}
