@page "/"
@using ins_tech_frontend_coding_task_blazor.Components
@using ins_tech_frontend_coding_task_blazor.Services
@inject ins_tech_frontend_coding_task_blazor.Services.FleetApiClient Api
@inject ins_tech_frontend_coding_task_blazor.Services.BoardState BoardState

<PageTitle>Anchorage planner</PageTitle>

<div class="board">
  @if (_isLoading)
      {
          <div>Loading...</div>
      }
      else if (_error is not null)
      {
          <div class="error">Error: @_error</div>
      }
      else if (BoardState.Initilized)
      {
          <AnchorageArea />
          <VesselPool />
      }
</div>

@code {
    private bool _isLoading = true;
    private string? _error;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var _data = await Api.GetRandomFleetAsync();
            if (_data is null)
            {
                _error = "Empty response from API.";
            }            
            else
            {
                BoardState.Initialize(_data);
            }
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
        finally
        {
            _isLoading = false;
        }
    }
}

